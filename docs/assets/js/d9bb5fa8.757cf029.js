"use strict";(self.webpackChunkdocusaurus_wiki=self.webpackChunkdocusaurus_wiki||[]).push([[2224],{9171:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"how_to_guides/ptp_sync_application","title":"Synchronize Time using PTP","description":"Overview","source":"@site/docs/how_to_guides/ptp_sync_application.md","sourceDirName":"how_to_guides","slug":"/how_to_guides/ptp_sync_application","permalink":"/dev/docs/how_to_guides/ptp_sync_application","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"howToSidebar","previous":{"title":"Use TCP API","permalink":"/dev/docs/how_to_guides/TCP_api"},"next":{"title":"Synchronize Azimuth Angle","permalink":"/dev/docs/how_to_guides/sync_angle"}}');var r=n(4848),s=n(8453),o=n(9030);const a={sidebar_position:4},l="Synchronize Time using PTP",c={},h=[{value:"Overview",id:"overview",level:2},{value:"Application Method",id:"application-method",level:2},{value:"PTP Time Synchronization through Software Simulation",id:"ptp-time-synchronization-through-software-simulation",level:3},{value:"1588v2 Protocol",id:"1588v2-protocol",level:4},{value:"linuxptp (recommended)",id:"linuxptp-recommended",level:5},{value:"ptpd",id:"ptpd",level:5},{value:"802.1AS Protocol",id:"8021as-protocol",level:4},{value:"PTP synchronization on a single lidar",id:"ptp-synchronization-on-a-single-lidar",level:5},{value:"PTP synchronization on multiple lidars",id:"ptp-synchronization-on-multiple-lidars",level:5},{value:"PTP Time Synchronization through Hardware Device",id:"ptp-time-synchronization-through-hardware-device",level:3},{value:"Common PTP Time Synchronization Issues troubleshooting",id:"ptp_troubleshooting",level:2},{value:"Lidar cannot establish PTP time synchronization correctly",id:"lidar-cannot-establish-ptp-time-synchronization-correctly",level:3},{value:"Lidar&#39;s PTP time synchronization status is not stable",id:"lidars-ptp-time-synchronization-status-is-not-stable",level:3}];function d(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"synchronize-time-using-ptp",children:"Synchronize Time using PTP"})}),"\n",(0,r.jsx)(t.h2,{id:"overview",className:"numbered-heading","data-number":"1","data-text":"Overview","data-toc-number":"1",children:"1 Overview"}),"\n",(0,r.jsx)(t.p,{children:"Hesai lidar products support PTP (Precision Time Protocol), which allows users to achieve precise time synchronization among multiple sensors."}),"\n",(0,r.jsx)(t.h2,{id:"application-method",className:"numbered-heading","data-number":"2","data-text":"Application Method","data-toc-number":"2",children:"2 Application Method"}),"\n",(0,r.jsx)(t.p,{children:"The method of using PTP time synchronization feature is as follows:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Configure PTP related settings of the lidar through web control page or LidarUtilities (see below figures, for the detailed information of each parameter setting please refer to the user manual of corresponding product):"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Web control page - Settings (Pandar series/QT series/XT series)"})}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/ptpconfig_web.png"),alt:"ptpconfig_web",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"LidarUtilities - Time Sync (OT128, AT128P, etc.)"})}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/ptpconfig_LU.png"),alt:"ptpconfig_LU",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsxs)(t.ol,{start:"2",children:["\n",(0,r.jsx)(t.li,{children:"After connecting the lidar to the external clock source device, configure clock source to PTP master and start time synchronization between the lidar and the PTP master."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Hesai lidar products support PTP time synchronization using software simulation or dedicated hardware clock device, with the detailed application method introduced as follows:"}),"\n",(0,r.jsx)(t.h3,{id:"ptp-time-synchronization-through-software-simulation",className:"numbered-heading","data-number":"2.1","data-text":"PTP Time Synchronization through Software Simulation","data-toc-number":"2.1",children:"2.1 PTP Time Synchronization through Software Simulation"}),"\n",(0,r.jsx)(t.p,{children:"Please refer to the below figure for the hardware connection method of PTP time synchronization through software simulation:"}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/ptpsetup_sw.jpg"),alt:"ptpsetup_sw",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsx)(t.p,{children:"For different types of PTP protocols, the PTP master can be configured in an Ubuntu OS PC according to the following methods:"}),"\n",(0,r.jsx)(t.h4,{id:"1588v2-protocol",className:"numbered-heading","data-number":"2.1.1","data-text":"1588v2 Protocol","data-toc-number":"2.1.1 1588",children:"2.1.1 1588v2 Protocol"}),"\n",(0,r.jsx)(t.p,{children:"For 1588v2 protocol, the commonly used open-source PTP time synchronization simulation software includes linuxptp and ptpd, with the corresponding configuration methods introduced as follows:"}),"\n",(0,r.jsx)(t.h5,{id:"linuxptp-recommended",className:"numbered-heading","data-number":"2.1.1.1","data-text":"linuxptp (recommended)","data-toc-number":"2.1.1.1",children:"2.1.1.1 linuxptp (recommended)"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Installation"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"sudo apt-get install linuxptp\n"})}),"\n",(0,r.jsxs)(t.ol,{start:"2",children:["\n",(0,r.jsx)(t.li,{children:"Use 'ethtool' command to check the PTP synchronization functions supported by the network interface of host computer"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"sudo apt-get install ethtool\nsudo ethtool -T <network interface name>\n"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsxs)(t.em,{children:["Note: For the method of checking the network interface name of host computer, please refer to ",(0,r.jsx)(t.a,{href:"/dev/docs/how_to_guides/network_config#how-to-check-the-network-interface-name-of-host-computer",children:"How to Check Network Interface Name of Host Computer in Ubuntu OS"}),"."]})}),"\n",(0,r.jsx)(t.p,{children:"-The terminal will print the below information:"}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/ethtoolprint.jpg"),alt:"ethtoolprint",style:{display:"block",margin:"0 auto",width:"auto"}}),"\n",(0,r.jsx)(t.p,{children:"The hardware or software displayed here indicates whether the network interface has hardware timestamp capability or only supports software timestamp.The synchronization accuracy of hardware timestamps can reach several microseconds or even lower, while the time synchronization error using software timestamps is generally larger than that with hardware timestamps."}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.strong,{children:"Run the following command to configure the host computer network interface as PTP master and start time synchronization"})}),"\n"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Network Transport -> ",(0,r.jsx)(t.strong,{children:"UDP/IP"})]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"sudo ptp4l \u2013m -4 \u2013i <network interface name> \u2013S\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Network Transport -> ",(0,r.jsx)(t.strong,{children:"L2"})]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"sudo ptp4l \u2013m -2 \u2013i <network interface name> \u2013S\n"})}),"\n",(0,r.jsxs)(t.ol,{start:"4",children:["\n",(0,r.jsxs)(t.li,{children:["Observe the printed message in terminal, when the network interface shows the ",(0,r.jsx)(t.strong,{children:"Grand Master"})," status, it means the host computer is successfully configured as PTP master:"]}),"\n"]}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/ptp4lprint.jpg"),alt:"ptp4lprint",style:{display:"block",margin:"0 auto",width:"auto"}}),"\n",(0,r.jsxs)(t.p,{children:["When the PTP status displayed on the web control page or LidarUtilities interface of the lidar is updated to ",(0,r.jsx)(t.em,{children:"Tracking"})," or ",(0,r.jsx)(t.em,{children:"Locked"}),", it means the time synchronization between the lidar and the PTP master has been successfully established (as shown in the below figures):"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Web control page - Home (Pandar series/QT series/XT series)"})}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/trackingstatus.jpg"),alt:"trackingstatus",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"LidarUtilities - Time Sync (OT128, AT128P, etc.)"})}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/lockedstatus.jpg"),alt:"lockedstatus",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsxs)(t.p,{children:["Note that when the PTP status of Hesai lidar products is displayed as'",(0,r.jsx)(t.strong,{children:"Tracking"}),"', it only means that the timestamp offset (Master Offset) between the current lidar and PTP master does not meet the 'Time Offset' parameter threshold corresponding to the'",(0,r.jsx)(t.strong,{children:"Locked"}),"'status (this threshold can be configured in the lidar's control page, default value is \xb11\u03bcs, maximum support to \xb1100\u03bcs), while actually the lidar is already in a normal PTP time synchronization state."]}),"\n",(0,r.jsx)(t.h5,{id:"ptpd",className:"numbered-heading","data-number":"2.1.1.2","data-text":"ptpd","data-toc-number":"2.1.1.2",children:"2.1.1.2 ptpd"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Installation"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"sudo apt-get install ptpd\n"})}),"\n",(0,r.jsxs)(t.ol,{start:"2",children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.strong,{children:"Run the following command to configure the host computer network interface as PTP master and start time synchronization"})}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"sudo ptpd -i <network interface name> -C -M\n"})}),"\n",(0,r.jsxs)(t.ol,{start:"3",children:["\n",(0,r.jsxs)(t.li,{children:["Observe the printed message in terminal, when the network interface shows the ",(0,r.jsx)(t.strong,{children:"PTP_MASTER"})," status, it means the host computer is successfully configured as PTP master:"]}),"\n"]}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/ptpdprint.jpg"),alt:"ptpdprint",style:{display:"block",margin:"0 auto",width:"auto"}}),"\n",(0,r.jsxs)(t.p,{children:["When the PTP status displayed on the web control page or LidarUtilities interface of the lidar is updated to ",(0,r.jsx)(t.em,{children:"Tracking"})," or ",(0,r.jsx)(t.em,{children:"Locked"}),", it means the time synchronization between the lidar and the PTP master has been successfully established."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Note: For the case of synchronizing multiple lidars with 1588v2 protocol, usually only a regular switch is needed to be added to the network to achieve the forwarding of PTP messages between the PTP master and each lidars. This process won't affect the configuration methods on the PTP master as mentioned above."})}),"\n",(0,r.jsx)(t.h4,{id:"8021as-protocol",className:"numbered-heading","data-number":"2.1.2","data-text":"802.1AS Protocol","data-toc-number":"2.1.2 802.1",children:"2.1.2 802.1AS Protocol"}),"\n",(0,r.jsx)(t.h5,{id:"ptp-synchronization-on-a-single-lidar",className:"numbered-heading","data-number":"2.1.2.1","data-text":"PTP synchronization on a single lidar","data-toc-number":"2.1.2.1",children:"2.1.2.1 PTP synchronization on a single lidar"}),"\n",(0,r.jsxs)(t.p,{children:["For PTP time synchronization using 802.1AS protocol on a single lidar, it is recommended to use the ",(0,r.jsx)(t.em,{children:"LinuxPTP"})," software tool for configuration. The operation method is as follows:"]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Installation"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"sudo apt-get install linuxptp\n"})}),"\n",(0,r.jsxs)(t.ol,{start:"2",children:["\n",(0,r.jsx)(t.li,{children:"Use 'ethtool' command to check the PTP synchronization functions supported by the network interface of host computer"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"sudo apt-get install ethtool\nsudo ethtool -T <network interface name>\n"})}),"\n",(0,r.jsxs)(t.ol,{start:"3",children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.strong,{children:"Run the following command to configure the host computer network interface as PTP master and start time synchronization"})}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"sudo ptp4l -S -i <network interface name> -m -f gPTP.cfg\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.em,{children:"gPTP.cfg"})," file from this command contains the basic parameter configurations required for the current PTP master. Please refer to the following information for details:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Standard 802.1AS Profile"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"[global]\ngmCapable       1\npriority1       248\npriority2       248\nlogAnnounceInterval 0\nlogSyncInterval     -3\nsyncReceiptTimeout  3\nneighborPropDelayThresh 800000\nmin_neighbor_prop_delay -20000000\nassume_two_step     1\npath_trace_enabled  1\nfollow_up_info      1\ntransportSpecific   0x1\nptp_dst_mac     01:80:C2:00:00:0E\nnetwork_transport   L2\ndelay_mechanism     P2P\ndomainNumber        0\n"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Note: Some Hesai lidar products (e.g. OT128, AT128P, etc.) support the option of 802.1AS (AUTOSAR) profile, while the PTP master configurations corresponding to this option is actually the same as the standard 802.1AS profile configuration as displayed above."})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"802.1AS Automotive Profile"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"[global]\ngmCapable       1\npriority1       248\npriority2       248\nlogAnnounceInterval 0\nlogSyncInterval     -3\nsyncReceiptTimeout  3\nneighborPropDelayThresh 800000\nmin_neighbor_prop_delay -20000000\nassume_two_step     1\npath_trace_enabled  1\nfollow_up_info      1\ntransportSpecific   0x1\nptp_dst_mac     01:80:C2:00:00:0E\nnetwork_transport   L2\ndelay_mechanism     P2P\ndomainNumber        0\n#\n\n# Automotive Profile Specific Options\n\n#\nBMCA            noop\nmasterOnly      1\ninhibit_announce    1\nasCapable               true\ninhibit_delay_req       1\n"})}),"\n",(0,r.jsxs)(t.ol,{start:"4",children:["\n",(0,r.jsxs)(t.li,{children:["Observe the printed message in terminal, when the network interface shows the ",(0,r.jsx)(t.strong,{children:"Grand Master"})," status, it means the host computer is successfully configured as PTP master:"]}),"\n"]}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/ptp4lprint_gptp.jpg"),alt:"ptp4lprint_gptp",style:{display:"block",margin:"0 auto",width:"auto"}}),"\n",(0,r.jsxs)(t.p,{children:["When the PTP status displayed on the web control page or LidarUtilities interface of the lidar is updated to ",(0,r.jsx)(t.em,{children:"Tracking"})," or ",(0,r.jsx)(t.em,{children:"Locked"}),", it means the time synchronization between the lidar and the PTP master has been successfully established."]}),"\n",(0,r.jsx)(t.h5,{id:"ptp-synchronization-on-multiple-lidars",className:"numbered-heading","data-number":"2.1.2.2","data-text":"PTP synchronization on multiple lidars","data-toc-number":"2.1.2.2",children:"2.1.2.2 PTP synchronization on multiple lidars"}),"\n",(0,r.jsxs)(t.p,{children:["To perform time synchronization on multiple lidars from the same network using 802.1AS protocol, it is necessary to first confirm whether the switch model used supports ",(0,r.jsx)(t.strong,{children:"TSN"})," (i.e. Time Sensitive Network, an extension protocol stack of IEEE 802.1 which is aimed at providing a universal time sensitive mechanism for the data link layer of Ethernet protocol to ensure real-time and reliable data transmission)."]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["For the switch that supports TSN, set the 'Switch Type' parameter of each lidar to '",(0,r.jsx)(t.strong,{children:"TSN"}),"' (as shown in the figures below), and configure the host computer as the PTP master according to method introduced above for a single lidar. When the PTP status displayed on the web control page or LidarUtilities interface of the lidar is updated to ",(0,r.jsx)(t.em,{children:"Tracking"})," or ",(0,r.jsx)(t.em,{children:"Locked"}),", it means the time synchronization between the lidar and the PTP master has been successfully established."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Web control page - Home (Pandar series/QT series/XT series)"})}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/TSN_web.jpg"),alt:"TSN_web",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"LidarUtilities - Time Sync (OT128, AT128P, etc.)"})}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/TSN.png"),alt:"TSN",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"For the ordinary type switch that does not support TSN, it is not possible to directly use standard Linuxptp software to achieve gPTP time synchronization for multiple lidars. Instead, users can refer to the following method to modify part of the source code in the original LinuxPTP program and make it compatible with the network using regular switches that can achieve gPTP time synchronization on multiple lidars:"}),"\n"]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Generate a new ptp4l.diff file according to the following code and copy it into the linuxptp folder:"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'diff --git a/port.c b/port.c\nindex b7fbfb1..3cd0ba4 100644\n--- a/port.c\n+++ b/port.c\n@@ -2278,21 +2278,10 @@ int process_pdelay_req(struct port *p, struct ptp_message *m)\n        p->delayMechanism = DM_P2P;\n        port_set_delay_tmo(p);\n\n        pr_debug("%s: peer port id set to %s", p->log_name,\n        pid2str(&p->peer_portid));\n\n    rsp = msg_allocate();\n    if (!rsp) {\n@@ -2475,8 +2464,8 @@ int process_pdelay_resp(struct port *p, struct ptp_message *m)\n         }\n\n    if (!p->peer_delay_req) {\n        pr_err("%s: rogue peer delay response", p->log_name);\n        return 0;\n    }\n    if (p->peer_portid_valid) {\n        if (!pid_eq(&p->peer_portid, &m->header.sourcePortIdentity)) }\n'})}),"\n",(0,r.jsxs)(t.ol,{start:"2",children:["\n",(0,r.jsx)(t.li,{children:"Compile and run in the path of linuxptp folder:"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"make clean\nmake\n"})}),"\n",(0,r.jsxs)(t.ol,{start:"3",children:["\n",(0,r.jsx)(t.li,{children:"Run the following command to modify the port. c file in the linuxptp folder based on the newly generated ptp4l.diff file (see figure below):"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"patch -p1 < ptp4l.diff\n"})}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/portc.png"),alt:"portc",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsxs)(t.ol,{start:"4",children:["\n",(0,r.jsx)(t.li,{children:"After modifying and saving, compile and run it using the 'make' command. After compiling, check the port. c file and confirm the content has been correctly modified as highlighted in the following figure:"}),"\n"]}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/portc-change.png"),alt:"Hesai logo",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsxs)(t.ol,{start:"5",children:["\n",(0,r.jsx)(t.li,{children:"Run the following command in the linuxptp folder to configure the host computer network interface as PTP master and start time synchronization:"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"sudo ptp4l -S -i <network interface name> -m -f gPTP.cfg\n"})}),"\n",(0,r.jsxs)(t.p,{children:["When the network interface shows the ",(0,r.jsx)(t.strong,{children:"Grand Master"})," status, it means the host computer is successfully configured as PTP master."]}),"\n",(0,r.jsxs)(t.ol,{start:"6",children:["\n",(0,r.jsxs)(t.li,{children:["Set the 'Switch Type' parameter of each lidar to '",(0,r.jsx)(t.strong,{children:"Non-TSN"}),"' (as shown in the figures below). When the PTP status displayed on the web control page or LidarUtilities interface of the lidar is updated to ",(0,r.jsx)(t.em,{children:"Tracking"})," or ",(0,r.jsx)(t.em,{children:"Locked"}),", it means the time synchronization between the lidar and the PTP master has been successfully established."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Web control page - Home (Pandar series/QT series/XT series)"})}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/nontsn_web.jpg"),alt:"nontsn_web",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"LidarUtilities - Time Sync (OT128, AT128P, etc.)"})}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/nontsn.png"),alt:"nontsn",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsx)(t.h3,{id:"ptp-time-synchronization-through-hardware-device",className:"numbered-heading","data-number":"2.2","data-text":"PTP Time Synchronization through Hardware Device","data-toc-number":"2.2",children:"2.2 PTP Time Synchronization through Hardware Device"}),"\n",(0,r.jsx)(t.p,{children:"Please refer to the below figure for the hardware connection method of PTP time synchronization through a dedicated hardware clock device:"}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/ptpsetup_hw.jpg"),alt:"ptpsetup_hw",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsx)(t.p,{children:"This PTP time synchronization method can typically achieve higher time synchronization accuracy (< 1\u03bcs).Similar to the software simulation method, users needs to configure the required PTP master parameters based on the selected PTP protocol and start the time synchronization process correctly according to the operation guidance of the hardware device (the following figure shows the parameter configuration interface of Trimble Thunderbolt GM200, a dedicated PTP master device)."}),"\n",(0,r.jsx)("img",{src:(0,o.Ay)("/img/trimbleptp.png"),alt:"trimbleptp",style:{display:"block",margin:"0 auto",width:"80%"}}),"\n",(0,r.jsxs)(t.p,{children:["After the hardware device is successfully configured as PTP master and starts PTP time synchronization, it can be confirmed whether the lidar is under the normal synchronization state by monitoring the PTP status of the lidar (which should be ",(0,r.jsx)(t.em,{children:"Tracking"})," or ",(0,r.jsx)(t.em,{children:"Locked"}),") and the timestamp information contained in the received point cloud data."]}),"\n",(0,r.jsx)(t.h2,{id:"ptp_troubleshooting",className:"numbered-heading","data-number":"3","data-text":"Common PTP Time Synchronization Issues troubleshooting","data-toc-number":"3",children:"3 Common PTP Time Synchronization Issues troubleshooting"}),"\n",(0,r.jsx)(t.h3,{id:"lidar-cannot-establish-ptp-time-synchronization-correctly",className:"numbered-heading","data-number":"3.1","data-text":"Lidar cannot establish PTP time synchronization correctly","data-toc-number":"3.1",children:"3.1 Lidar cannot establish PTP time synchronization correctly"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Check whether the hardware connection of the PTP time synchronization network is good;"}),"\n",(0,r.jsx)(t.li,{children:"Check whether the PTP synchronization message between the lidar and PTP master clock is correctly sent out (users can check the PTP protocol related messages in the data stream through use Wireshark software). If the message is sent out but not received, check whether the network bandwidth load could exceed the limit and cause packet loss;"}),"\n",(0,r.jsxs)(t.li,{children:["Check whether the PTP parameter configuration of the lidar is consistent with the parameter configuration of the PTP master. See detailed configuration method ",(0,r.jsx)(t.a,{href:"#application-method",children:"here"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"lidars-ptp-time-synchronization-status-is-not-stable",className:"numbered-heading","data-number":"3.2","data-text":"Lidar's PTP time synchronization status is not stable","data-toc-number":"3.2",children:"3.2 Lidar's PTP time synchronization status is not stable"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Check whether the hardware connection of the PTP time synchronization network is good;"}),"\n",(0,r.jsx)(t.li,{children:"Check whether the PTP master is working properly and whether there is any abnormal timestamp jump phenomenon occurred on the PTP master;"}),"\n",(0,r.jsx)(t.li,{children:"Check whether the lidar can receive PTP Sync messages sent by the PTP master correctly (users can check the PTP protocol related messages in the data stream through use Wireshark software);"}),"\n",(0,r.jsxs)(t.li,{children:["For 1588v2 protocol, if there are multiple lidars or other devices connected to the current time synchronization network, and PTP time synchronization cannot be established or frequently switch to unlock status after synchronization, need to check whether the data volume transmitted in the network is close to the upper limit of Ethernet port bandwidth on the host computer. It is recommended to  configure the parameter '",(0,r.jsx)(t.em,{children:"PTP Network Transport"}),"' on the lidar and PTP master to ",(0,r.jsx)(t.strong,{children:"L2"})," to avoid the impact of IP network layer data load on the transmission of PTP messages at the receiving and transmitting Ethernet ports;"]}),"\n",(0,r.jsxs)(t.li,{children:["For 802.1AS protocol, if the PTP time synchronization state of the lidar is unstable and switches between locked and unlock status, need to check whether the Sync message's period parameter (",(0,r.jsx)(t.em,{children:"logSyncInterval"}),") from the PTP master is consistent with this parameter from the lidar (for Hesei lidar products, this parameter is fixed at -3)."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"If other PTP time synchronization issues persist after following the above steps, please contact Hesai Technical Support."})]})}function p(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);